## [Unreleased]

## [2.0.0.alpha1] - unreleased

### Breaking changes

- `ReversibleId` now no longer downcases the encodedid input string by default on decode, ie the `decode` option `downcase` is now `false`. In a future release the `downcase` option will be removed.
- The default encoding engine is now `:sqids` to reflect the official "deprecated" status of `Hashid`s (see https://sqids.org/faq#why-hashids) 
- Ruby < 3.2 support dropped. The minimum supported Ruby version is now 3.2.0

**Important!!: `:sqids` are not compatible with `:hashids`, DO NOT CHANGE FROM ONE TO THE OTHER AFTER GOING LIVE.**

## [1.0.0.rc6] - unreleased

### Added

- Added support for [Sqids](https://sqids.org) as an alternative ID encoding engine. The default remains HashIds for backward compatibility. 
- New encoder abstraction layer allows switching between HashIds and Sqids via the `encoder: :sqids` or `encoder: :hashids` parameter to `ReversibleId.new`.
- Support for blocklists in both HashIds and Sqids encoders to prevent generating IDs containing specific words. Use the `blocklist` parameter with a `Set` or `Array` of strings to `ReversibleId.new`. For Hashids encodings, an error will be raised if a generated ID contains a blocklisted word. For Sqids a new ID is generated that does not contain the block word.

### Added (Rails integration)

- Merged `encoded_id-rails` gem into the monorepo
- `#encoded_id` now defaults to returning an 'annotated' ID, one in which a prefix is added to the encoded ID to indicate the 'type' of the record the ID represents. This can be disabled. IDs generated by older versions of this gem will decode correctly. But note that IDs generated by this version onwards will not decode correctly by older versions of this gem so make sure to disable annotation if you need to support older versions of this gem.
- New `EncodedId::Rails::Persists` module which adds hooks to the model to persist the encoded ID to the DB (see docs).
- `#encoded_id_hash` has been added to return only the encoded ID without an annotation prefix. If annotation is disabled, this method is basically an alias to `#encoded_id`.
- `.find_all_by_encoded_id` has been added to return all records matching the given encoded ID. This will return all matching records whose IDs are encoded in the encoded_id. Missing records are ignored.
- `.find_all_by_encoded_id!` like `.find_all_by_encoded_id` but raises an `ActiveRecord::RecordNotFound` exception if *any* of the records are not found.
- `Configuration#model_to_param_returns_encoded_id` to allow `EncodedId::Rails::Model` inclusion to also bring in `EncodedId::Rails::PathParam` automatically.

### Changed (Rails integration)

- `#name_for_encoded_id_slug` no longer provides a default implementation, it is up to the user to define this method, or configure the gem to use a different method name.
- `#slugged_encoded_id` no longer takes a `with:` parameter. To specify the name of the method to call to generate the slug, use the `slug_value_method_name` configuration option.

### Fixed (Rails integration)

- `#decode_encoded_id` now raises if the encoded ID is not a string.
- Handle more cases where a record held onto a memoized `encoded_id` even though its `id` had changed

## [1.0.0.rc5] - 2025-04-09

- `encoded_id` now uses its own implementation of `hashids` which is more efficient and has a smaller memory footprint. This massively reduces the GC churn in high-throughput applications. This is an implementation based on the original `hashids` gem but with many optimisations and improvements. Functionally it is identical to the original `hashids` gem.

## [1.0.0.rc4] - 2024-04-29

- Add an optional `max_inputs_per_id` argument to `ReversibleId`, thanks to [@avcwisesa](https://github.com/avcwisesa)
- The option `split_with:` can also now be set to nil to disable splitting of the encoded ID string

## [1.0.0.rc3] - 2023-10-23

- Add an optional `max_length` argument to `ReversibleId`, thanks to [@jugglebird](https://github.com/jugglebird)
- Alphabet validations to prevent whitespace and null chars
- Add `Alphabet#to_a`, `Alphabet#to_s`, `Alphabet#size` and a custom `Alphabet#inspect`
- Fixes to input validations
- hashids are case-sensitive, as are `Alphabet`s, however `ReversibleId` was always `downcase`ing the encodedid input string on decode. A new option has been added to `decode` and `decode_hex`, `downcase`, which defaults to `true`. Thus, the default behaviour is unchanged, but you can opt out to allow mixed case encodedid decode. *Note:* In V2 this will default to `false`.

## [1.0.0.rc2] - 2023-08-07

- `Alphabet` now has `#include?` and `#unique_charaters` methods

## [1.0.0.rc1] - 2023-08-06

- Improved RBS definitions
- Improved test coverage

## [0.4.0] - 2022-12-04

- Support custom 'split' character which must not be in the alphabet
- Ability to provide a custom character equivalence mapping

## [0.3.0] - 2022-10-12

- Fix splitting of encoded ID string
- Checks that integer values to be encoded are positive
- Experimental support for encoding hex strings

## [0.1.0] - 2022-10-11

- Initial release

## Rails Integration History

## [0.6.2] - 2023-02-09

- Fix `encoded_id` memoization clearing when record is duplicated

## [0.6.1] - 2023-02-09

- Fix `#encoded_id` to return nil if `#id` is nil
- Ensure `encoded_id` memoization is cleared when record is duplicated, or id changes

## [0.6.0] - 2022-12-21

- Rename mixin to `Model`
- Introduce optional mixins for overriding `#to_param`

## [0.5.0] - 2022-12-21

- `name_for_encoded_id_slug` no longer uses the return value from name but rather just uses the `class` `name`.
- If you want to change the name used in the slug, override `name_for_encoded_id_slug`

## [0.4.0] - 2022-12-18

- Refactor internals, remove any methods not actually related to creating `encoded_id`, (eg `slugged_id` was removed).

## [0.3.1] - 2022-12-15

- Fix default config

## [0.3.0] - 2022-12-15

- Updates gem `encoded_id` dependency and fixes configuration

## [0.2.0] - 2022-12-14

- No notes...

## [0.1.0] - 2022-11-17

- Initial release of Rails integration