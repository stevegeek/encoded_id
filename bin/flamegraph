#!/usr/bin/env ruby --yjit
# frozen_string_literal: true

require "bundler/setup"

require "encoded_id"
require "singed"

Singed.output_directory = "./tmp"

# HashId encoder
hashid_coder = ::EncodedId::ReversibleId.new(salt: "Salt!", encoder: :hashids)
input_for_flamegraph = 100.times.map { rand(1000) }.freeze
hashid_encoded = hashid_coder.encode(input_for_flamegraph)

flamegraph("hashid_encode") {
  10_000.times { hashid_coder.encode(input_for_flamegraph) }
}

flamegraph("hashid_decode") {
  10_000.times { hashid_coder.decode(hashid_encoded) }
}

# Sqids encoder
sqids_coder = ::EncodedId::ReversibleId.new(salt: "Salt!", encoder: :sqids)
sqids_encoded = sqids_coder.encode(input_for_flamegraph)

flamegraph("sqids_encode") {
  10_000.times { sqids_coder.encode(input_for_flamegraph) }
}

flamegraph("sqids_decode") {
  10_000.times { sqids_coder.decode(sqids_encoded) }
}
